# دليل التثبيت والتشغيل - نظام آيديا المحدث

## نظرة عامة

هذا الدليل يوضح كيفية تثبيت وتشغيل نظام آيديا المحدث الذي يتضمن:
- الموقع الرئيسي المحسن
- لوحة تحكم العملاء
- نظام إدارة المهام للفريق
- نظام Django CMS للإدارة

## متطلبات النظام

### متطلبات الخادم:
- **نظام التشغيل**: Ubuntu 20.04+ أو CentOS 8+ أو Windows Server 2019+
- **المعالج**: 2 CPU cores أو أكثر
- **الذاكرة**: 4GB RAM كحد أدنى، 8GB مُوصى به
- **التخزين**: 20GB مساحة فارغة كحد أدنى
- **الشبكة**: اتصال إنترنت مستقر

### متطلبات البرمجيات:
- **Python**: 3.8+ (مُوصى به 3.11)
- **Node.js**: 16+ (مُوصى به 18+)
- **قاعدة البيانات**: PostgreSQL 12+ أو MySQL 8+ أو SQLite (للتطوير)
- **خادم الويب**: Nginx أو Apache
- **Git**: لإدارة الإصدارات

## التثبيت خطوة بخطوة

### 1. تحضير البيئة

#### على Ubuntu/Debian:
```bash
# تحديث النظام
sudo apt update && sudo apt upgrade -y

# تثبيت Python و pip
sudo apt install python3 python3-pip python3-venv -y

# تثبيت Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install nodejs -y

# تثبيت PostgreSQL (اختياري)
sudo apt install postgresql postgresql-contrib -y

# تثبيت Nginx
sudo apt install nginx -y

# تثبيت Git
sudo apt install git -y
```

#### على CentOS/RHEL:
```bash
# تحديث النظام
sudo yum update -y

# تثبيت Python
sudo yum install python3 python3-pip -y

# تثبيت Node.js
sudo yum install nodejs npm -y

# تثبيت PostgreSQL
sudo yum install postgresql postgresql-server -y

# تثبيت Nginx
sudo yum install nginx -y

# تثبيت Git
sudo yum install git -y
```

### 2. إعداد المشروع

```bash
# إنشاء مجلد المشروع
sudo mkdir -p /var/www/idea-system
cd /var/www/idea-system

# فك ضغط ملفات النظام
unzip improved_idea_system.zip
sudo chown -R www-data:www-data /var/www/idea-system
```

### 3. إعداد نظام Django CMS

```bash
# الانتقال إلى مجلد Django
cd /var/www/idea-system/idea_cms_project

# إنشاء بيئة افتراضية
python3 -m venv venv
source venv/bin/activate

# تثبيت المتطلبات
pip install -r requirements.txt

# إعداد قاعدة البيانات
python manage.py makemigrations
python manage.py migrate

# إنشاء مستخدم إداري
python manage.py createsuperuser

# جمع الملفات الثابتة
python manage.py collectstatic --noinput
```

### 4. إعداد قاعدة البيانات

#### PostgreSQL:
```bash
# تسجيل الدخول إلى PostgreSQL
sudo -u postgres psql

# إنشاء قاعدة البيانات والمستخدم
CREATE DATABASE idea_cms;
CREATE USER idea_user WITH PASSWORD 'secure_password_here';
GRANT ALL PRIVILEGES ON DATABASE idea_cms TO idea_user;
\q
```

#### تحديث إعدادات Django:
```python
# في ملف settings.py
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'idea_cms',
        'USER': 'idea_user',
        'PASSWORD': 'secure_password_here',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}
```

### 5. إعداد خادم الويب (Nginx)

```bash
# إنشاء ملف إعداد Nginx
sudo nano /etc/nginx/sites-available/idea-system
```

```nginx
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;
    root /var/www/idea-system;
    index index.html;

    # الموقع الرئيسي
    location / {
        try_files $uri $uri/ /website_project_v3/index.html;
    }

    # لوحة تحكم العملاء
    location /client-portal/ {
        alias /var/www/idea-system/client_portal/;
        try_files $uri $uri/ /client_portal/index.html;
    }

    # نظام إدارة المهام
    location /team-management/ {
        alias /var/www/idea-system/team_management/;
        try_files $uri $uri/ /team_management/index.html;
    }

    # لوحة التحكم الإدارية
    location /admin-panel/ {
        alias /var/www/idea-system/admin_panel/;
        try_files $uri $uri/ /admin_panel/index.html;
    }

    # Django CMS API
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Django Admin
    location /django-admin/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # الملفات الثابتة
    location /static/ {
        alias /var/www/idea-system/idea_cms_project/static/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    location /media/ {
        alias /var/www/idea-system/idea_cms_project/media/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # ضغط الملفات
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;

    # الأمان
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
}
```

```bash
# تفعيل الموقع
sudo ln -s /etc/nginx/sites-available/idea-system /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

### 6. إعداد خدمة Django (Systemd)

```bash
# إنشاء ملف خدمة
sudo nano /etc/systemd/system/idea-cms.service
```

```ini
[Unit]
Description=Idea CMS Django Application
After=network.target

[Service]
Type=exec
User=www-data
Group=www-data
WorkingDirectory=/var/www/idea-system/idea_cms_project
Environment=PATH=/var/www/idea-system/idea_cms_project/venv/bin
ExecStart=/var/www/idea-system/idea_cms_project/venv/bin/python manage.py runserver 127.0.0.1:8000
ExecReload=/bin/kill -s HUP $MAINPID
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

```bash
# تفعيل وتشغيل الخدمة
sudo systemctl daemon-reload
sudo systemctl enable idea-cms
sudo systemctl start idea-cms
sudo systemctl status idea-cms
```

## التشغيل والاختبار

### 1. التحقق من حالة الخدمات

```bash
# التحقق من Nginx
sudo systemctl status nginx

# التحقق من Django
sudo systemctl status idea-cms

# التحقق من قاعدة البيانات
sudo systemctl status postgresql
```

### 2. اختبار الوصول

- **الموقع الرئيسي**: `http://your-domain.com`
- **لوحة تحكم العملاء**: `http://your-domain.com/client-portal/`
- **نظام إدارة المهام**: `http://your-domain.com/team-management/`
- **لوحة التحكم الإدارية**: `http://your-domain.com/admin-panel/`
- **Django Admin**: `http://your-domain.com/django-admin/`

### 3. بيانات الاختبار

#### لوحة تحكم العملاء:
- **البريد الإلكتروني**: `demo@client.com`
- **كلمة المرور**: `demo123`

#### نظام إدارة المهام:
- **البريد الإلكتروني**: `manager@ideateeam.com`
- **كلمة المرور**: `manager123`

#### Django Admin:
- استخدم البيانات التي أنشأتها بأمر `createsuperuser`

## الصيانة والتحديث

### 1. النسخ الاحتياطية

```bash
# نسخ احتياطية لقاعدة البيانات
sudo -u postgres pg_dump idea_cms > backup_$(date +%Y%m%d_%H%M%S).sql

# نسخ احتياطية للملفات
tar -czf idea_system_backup_$(date +%Y%m%d_%H%M%S).tar.gz /var/www/idea-system
```

### 2. التحديثات

```bash
# تحديث النظام
cd /var/www/idea-system/idea_cms_project
source venv/bin/activate

# تحديث المتطلبات
pip install -r requirements.txt --upgrade

# تطبيق تحديثات قاعدة البيانات
python manage.py makemigrations
python manage.py migrate

# جمع الملفات الثابتة
python manage.py collectstatic --noinput

# إعادة تشغيل الخدمة
sudo systemctl restart idea-cms
```

### 3. مراقبة الأداء

```bash
# مراقبة استخدام الموارد
htop

# مراقبة سجلات Nginx
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# مراقبة سجلات Django
sudo journalctl -u idea-cms -f
```

## الأمان

### 1. إعدادات الجدار الناري

```bash
# تفعيل UFW
sudo ufw enable

# السماح بـ SSH
sudo ufw allow ssh

# السماح بـ HTTP و HTTPS
sudo ufw allow 'Nginx Full'

# عرض الحالة
sudo ufw status
```

### 2. تحديث كلمات المرور

```bash
# تغيير كلمة مرور قاعدة البيانات
sudo -u postgres psql
ALTER USER idea_user PASSWORD 'new_secure_password';
\q

# تحديث settings.py بكلمة المرور الجديدة
```

### 3. شهادات SSL (Let's Encrypt)

```bash
# تثبيت Certbot
sudo apt install certbot python3-certbot-nginx -y

# الحصول على شهادة SSL
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# تجديد تلقائي
sudo crontab -e
# إضافة: 0 12 * * * /usr/bin/certbot renew --quiet
```

## حل المشاكل الشائعة

### 1. خطأ 502 Bad Gateway

```bash
# التحقق من حالة Django
sudo systemctl status idea-cms

# إعادة تشغيل الخدمة
sudo systemctl restart idea-cms

# التحقق من السجلات
sudo journalctl -u idea-cms -n 50
```

### 2. مشاكل الأذونات

```bash
# إصلاح أذونات الملفات
sudo chown -R www-data:www-data /var/www/idea-system
sudo chmod -R 755 /var/www/idea-system
```

### 3. مشاكل قاعدة البيانات

```bash
# إعادة إنشاء قاعدة البيانات
cd /var/www/idea-system/idea_cms_project
source venv/bin/activate
python manage.py flush
python manage.py migrate
```

## الدعم والمساعدة

### معلومات الاتصال:
- **البريد الإلكتروني**: support@ideateeam.com
- **الهاتف**: 773171477
- **الموقع**: www.ideateeam.com

### الموارد المفيدة:
- [وثائق Django](https://docs.djangoproject.com/)
- [وثائق Nginx](https://nginx.org/en/docs/)
- [وثائق PostgreSQL](https://www.postgresql.org/docs/)

---

**تاريخ الإنشاء**: 30 أغسطس 2025  
**الإصدار**: 1.0  
**المؤلف**: فريق آيديا للاستشارات والحلول التسويقية

