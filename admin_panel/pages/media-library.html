<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مكتبة الوسائط - لوحة تحكم آيديا</title>
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .media-container {
            padding: 20px;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
        }
        
        .upload-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        
        .media-filters {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-label {
            font-size: 12px;
            color: #6c757d;
            font-weight: bold;
        }
        
        .filter-select,
        .filter-input {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            min-width: 150px;
        }
        
        .filter-select:focus,
        .filter-input:focus {
            outline: none;
            border-color: #6f42c1;
        }
        
        .view-toggle {
            display: flex;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .view-btn {
            padding: 10px 15px;
            border: none;
            background: transparent;
            cursor: pointer;
            color: #6c757d;
            transition: all 0.3s ease;
        }
        
        .view-btn.active {
            background: #6f42c1;
            color: white;
        }
        
        .media-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }
        
        .stat-card.images::before {
            background: linear-gradient(135deg, #007bff, #0056b3);
        }
        
        .stat-card.videos::before {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .stat-card.documents::before {
            background: linear-gradient(135deg, #ffc107, #e0a800);
        }
        
        .stat-card.total-size::before {
            background: linear-gradient(135deg, #6f42c1, #5a32a3);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 14px;
        }
        
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .media-list {
            display: none;
        }
        
        .media-item {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .media-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .media-preview {
            width: 100%;
            height: 200px;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .media-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .media-preview .file-icon {
            font-size: 48px;
            color: #6c757d;
        }
        
        .media-type-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            color: white;
        }
        
        .type-image {
            background-color: #007bff;
        }
        
        .type-video {
            background-color: #dc3545;
        }
        
        .type-document {
            background-color: #ffc107;
            color: #212529;
        }
        
        .media-info {
            padding: 15px;
        }
        
        .media-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .media-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 10px;
        }
        
        .media-actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .btn-view {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-view:hover {
            background-color: #138496;
        }
        
        .btn-edit {
            background-color: #ffc107;
            color: #212529;
        }
        
        .btn-edit:hover {
            background-color: #e0a800;
        }
        
        .btn-download {
            background-color: #28a745;
            color: white;
        }
        
        .btn-download:hover {
            background-color: #218838;
        }
        
        .btn-delete {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-delete:hover {
            background-color: #c82333;
        }
        
        .upload-area {
            border: 2px dashed #e9ecef;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: white;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        
        .upload-area.dragover {
            border-color: #6f42c1;
            background-color: #f8f9fa;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #6c757d;
            margin-bottom: 15px;
        }
        
        .upload-text {
            color: #6c757d;
            margin-bottom: 15px;
        }
        
        .upload-input {
            display: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 12px;
            width: 95%;
            max-width: 800px;
            max-height: 95vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #6f42c1, #5a32a3);
            color: white;
            border-radius: 12px 12px 0 0;
        }
        
        .modal-header h3 {
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .media-details {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        .media-preview-large {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .media-properties {
            display: grid;
            gap: 15px;
        }
        
        .property-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .property-label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .property-value {
            color: #6c757d;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #6f42c1;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background-color: #6f42c1;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #5a32a3;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #545b62;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
        }
        
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #e9ecef;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pagination button:hover {
            background-color: #f8f9fa;
        }
        
        .pagination button.active {
            background-color: #6f42c1;
            color: white;
            border-color: #6f42c1;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        @media (max-width: 768px) {
            .media-filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                width: 100%;
            }
            
            .media-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .media-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- الشريط الجانبي -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h3>لوحة تحكم آيديا</h3>
            <button id="sidebar-toggle" class="sidebar-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <ul>
                <li>
                    <a href="../pages/dashboard/dashboard.html">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>لوحة القيادة</span>
                    </a>
                </li>
                <li>
                    <a href="pages-management.html">
                        <i class="fas fa-file-alt"></i>
                        <span>إدارة الصفحات</span>
                    </a>
                </li>
                <li>
                    <a href="blog-management.html">
                        <i class="fas fa-blog"></i>
                        <span>إدارة المدونة</span>
                    </a>
                </li>
                <li>
                    <a href="forms-management.html">
                        <i class="fas fa-wpforms"></i>
                        <span>إدارة النماذج</span>
                    </a>
                </li>
                <li>
                    <a href="analytics.html">
                        <i class="fas fa-chart-bar"></i>
                        <span>التحليلات</span>
                    </a>
                </li>
                <li>
                    <a href="messages.html">
                        <i class="fas fa-envelope"></i>
                        <span>الرسائل</span>
                    </a>
                </li>
                <li class="active">
                    <a href="media-library.html">
                        <i class="fas fa-images"></i>
                        <span>مكتبة الوسائط</span>
                    </a>
                </li>
                <li>
                    <a href="settings.html">
                        <i class="fas fa-cog"></i>
                        <span>الإعدادات</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <div class="sidebar-footer">
            <button onclick="logout()" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>تسجيل الخروج</span>
            </button>
        </div>
    </div>

    <!-- المحتوى الرئيسي -->
    <div id="main-content" class="main-content">
        <!-- الشريط العلوي -->
        <header class="top-bar">
            <div class="top-bar-left">
                <button id="sidebar-toggle-mobile" class="sidebar-toggle-mobile">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>مكتبة الوسائط</h1>
            </div>
            <div class="top-bar-right">
                <div class="user-menu">
                    <button class="user-menu-toggle">
                        <i class="fas fa-user-circle"></i>
                        <span>المدير</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="user-menu-dropdown">
                        <a href="#" onclick="updateProfile()">
                            <i class="fas fa-user"></i>
                            الملف الشخصي
                        </a>
                        <a href="#" onclick="changePassword()">
                            <i class="fas fa-key"></i>
                            تغيير كلمة المرور
                        </a>
                        <a href="#" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            تسجيل الخروج
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- محتوى الصفحة -->
        <div class="media-container">
            <!-- رأس الصفحة -->
            <div class="page-header">
                <h2 class="page-title">مكتبة الوسائط</h2>
                <button class="upload-btn" onclick="showUploadModal()">
                    <i class="fas fa-upload"></i>
                    رفع ملفات
                </button>
            </div>

            <!-- إحصائيات الوسائط -->
            <div class="media-stats">
                <div class="stat-card images">
                    <div class="stat-value" id="images-count">0</div>
                    <div class="stat-label">الصور</div>
                </div>
                <div class="stat-card videos">
                    <div class="stat-value" id="videos-count">0</div>
                    <div class="stat-label">الفيديوهات</div>
                </div>
                <div class="stat-card documents">
                    <div class="stat-value" id="documents-count">0</div>
                    <div class="stat-label">المستندات</div>
                </div>
                <div class="stat-card total-size">
                    <div class="stat-value" id="total-size">0 MB</div>
                    <div class="stat-label">الحجم الإجمالي</div>
                </div>
            </div>

            <!-- فلاتر البحث -->
            <div class="media-filters">
                <div class="filter-group">
                    <label class="filter-label">نوع الملف</label>
                    <select id="type-filter" class="filter-select">
                        <option value="">جميع الأنواع</option>
                        <option value="image">الصور</option>
                        <option value="video">الفيديوهات</option>
                        <option value="document">المستندات</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">البحث</label>
                    <input type="text" id="search-filter" class="filter-input" placeholder="البحث في الملفات...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">التاريخ من</label>
                    <input type="date" id="date-from-filter" class="filter-input">
                </div>
                <div class="filter-group">
                    <label class="filter-label">التاريخ إلى</label>
                    <input type="date" id="date-to-filter" class="filter-input">
                </div>
                <div class="filter-group">
                    <label class="filter-label">العرض</label>
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="switchView('grid')">
                            <i class="fas fa-th"></i>
                        </button>
                        <button class="view-btn" onclick="switchView('list')">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- منطقة الرفع -->
            <div class="upload-area" id="upload-area">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-text">
                    اسحب الملفات هنا أو انقر لاختيار الملفات
                </div>
                <input type="file" id="file-input" class="upload-input" multiple accept="image/*,video/*,.pdf,.doc,.docx">
                <button class="upload-btn" onclick="document.getElementById('file-input').click()">
                    <i class="fas fa-plus"></i>
                    اختيار الملفات
                </button>
            </div>

            <!-- عرض الوسائط -->
            <div id="media-loading" class="loading" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i>
                جاري التحميل...
            </div>
            
            <div class="media-grid" id="media-grid" style="display: none;">
                <!-- سيتم ملء الوسائط هنا -->
            </div>
            
            <div class="media-list" id="media-list">
                <!-- عرض القائمة -->
            </div>
            
            <div id="media-no-data" class="no-data" style="display: none;">
                <i class="fas fa-images"></i>
                <p>لا توجد ملفات متاحة</p>
            </div>

            <!-- ترقيم الصفحات -->
            <div class="pagination" id="pagination" style="display: none;">
                <!-- سيتم إضافة أزرار الترقيم هنا -->
            </div>
        </div>
    </div>

    <!-- نموذج عرض الوسائط -->
    <div id="media-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="media-modal-title">تفاصيل الملف</h3>
                <button class="modal-close" onclick="closeMediaModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="media-details" id="media-details">
                    <!-- سيتم ملء تفاصيل الوسائط هنا -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeMediaModal()">إغلاق</button>
                <button type="button" class="btn btn-primary" onclick="downloadMedia()" id="download-btn">تحميل</button>
                <button type="button" class="btn btn-primary" onclick="editMedia()" id="edit-btn">تعديل</button>
            </div>
        </div>
    </div>

    <!-- نموذج تعديل الوسائط -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>تعديل الملف</h3>
                <button class="modal-close" onclick="closeEditModal()">×</button>
            </div>
            <div class="modal-body">
                <form id="edit-media-form">
                    <div class="form-group">
                        <label for="media-title">عنوان الملف</label>
                        <input type="text" id="media-title" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="media-description">وصف الملف</label>
                        <textarea id="media-description" name="description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="media-alt">النص البديل (Alt Text)</label>
                        <input type="text" id="media-alt" name="alt_text">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeEditModal()">إلغاء</button>
                <button type="button" class="btn btn-primary" onclick="saveMediaChanges()">حفظ التغييرات</button>
            </div>
        </div>
    </div>

    <!-- حاوية الإشعارات -->
    <div id="notifications-container" class="notifications-container"></div>

    <!-- تضمين ملفات JavaScript -->
    <script src="../assets/js/common.js"></script>
    <script>
        // متغيرات عامة
        let currentMediaId = null;
        let currentPage = 1;
        let totalPages = 1;
        let mediaPerPage = 20;
        let currentView = 'grid';

        // تحميل البيانات عند بدء التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            loadMedia();
            loadMediaStats();
            setupUploadArea();
            
            // إضافة مستمعات للفلاتر
            document.getElementById('type-filter').addEventListener('change', loadMedia);
            document.getElementById('search-filter').addEventListener('input', debounce(loadMedia, 500));
            document.getElementById('date-from-filter').addEventListener('change', loadMedia);
            document.getElementById('date-to-filter').addEventListener('change', loadMedia);
            document.getElementById('file-input').addEventListener('change', handleFileUpload);
        });

        // دالة تحميل الوسائط
        async function loadMedia(page = 1) {
            showMediaLoading();
            currentPage = page;
            
            try {
                // بناء معاملات البحث
                const params = new URLSearchParams({
                    page: page,
                    page_size: mediaPerPage
                });
                
                const typeFilter = document.getElementById('type-filter').value;
                const searchFilter = document.getElementById('search-filter').value;
                const dateFromFilter = document.getElementById('date-from-filter').value;
                const dateToFilter = document.getElementById('date-to-filter').value;
                
                if (typeFilter) params.append('type', typeFilter);
                if (searchFilter) params.append('search', searchFilter);
                if (dateFromFilter) params.append('date_from', dateFromFilter);
                if (dateToFilter) params.append('date_to', dateToFilter);
                
                // محاولة جلب البيانات من API
                try {
                    const data = await adminPanel.apiRequest(`/media/?${params.toString()}`);
                    displayMedia(data);
                } catch (error) {
                    // في حالة عدم توفر API، عرض بيانات تجريبية
                    displaySampleMedia();
                }
                
            } catch (error) {
                console.error('Error loading media:', error);
                showMediaNoData();
            }
        }

        // دالة عرض الوسائط
        function displayMedia(data) {
            const container = currentView === 'grid' ? document.getElementById('media-grid') : document.getElementById('media-list');
            const media = data.results || data;
            
            if (!media || media.length === 0) {
                showMediaNoData();
                return;
            }
            
            if (currentView === 'grid') {
                container.innerHTML = media.map(item => createMediaCard(item)).join('');
            } else {
                container.innerHTML = media.map(item => createMediaListItem(item)).join('');
            }
            
            // تحديث الترقيم
            updatePagination(data);
            showMediaGrid();
        }

        // دالة عرض بيانات تجريبية
        function displaySampleMedia() {
            const sampleMedia = [
                {
                    id: 1,
                    title: 'شعار آيديا',
                    filename: 'idea-logo.png',
                    type: 'image',
                    size: '245 KB',
                    uploaded_at: '2024-01-15',
                    url: '/assets/images/logo.png'
                },
                {
                    id: 2,
                    title: 'فيديو تعريفي',
                    filename: 'intro-video.mp4',
                    type: 'video',
                    size: '15.2 MB',
                    uploaded_at: '2024-01-14',
                    url: '/assets/videos/intro.mp4'
                },
                {
                    id: 3,
                    title: 'كتيب الخدمات',
                    filename: 'services-brochure.pdf',
                    type: 'document',
                    size: '2.1 MB',
                    uploaded_at: '2024-01-13',
                    url: '/assets/documents/brochure.pdf'
                }
            ];
            
            const container = currentView === 'grid' ? document.getElementById('media-grid') : document.getElementById('media-list');
            
            if (currentView === 'grid') {
                container.innerHTML = sampleMedia.map(item => createMediaCard(item)).join('');
            } else {
                container.innerHTML = sampleMedia.map(item => createMediaListItem(item)).join('');
            }
            
            showMediaGrid();
        }

        // دالة إنشاء بطاقة الوسائط
        function createMediaCard(item) {
            const typeClass = `type-${item.type}`;
            const typeText = getTypeText(item.type);
            const icon = getFileIcon(item.type, item.filename);
            
            return `
                <div class="media-item" onclick="viewMedia(${item.id})">
                    <div class="media-preview">
                        ${item.type === 'image' ? 
                            `<img src="${item.url || '/placeholder-image.jpg'}" alt="${item.title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                             <div class="file-icon" style="display: none;"><i class="${icon}"></i></div>` :
                            `<div class="file-icon"><i class="${icon}"></i></div>`
                        }
                        <div class="media-type-badge ${typeClass}">${typeText}</div>
                    </div>
                    <div class="media-info">
                        <div class="media-name" title="${item.title}">${item.title}</div>
                        <div class="media-meta">
                            <span>${item.size}</span>
                            <span>${formatDate(item.uploaded_at)}</span>
                        </div>
                        <div class="media-actions">
                            <button class="action-btn btn-view" onclick="event.stopPropagation(); viewMedia(${item.id})" title="عرض">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn btn-edit" onclick="event.stopPropagation(); editMedia(${item.id})" title="تعديل">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-download" onclick="event.stopPropagation(); downloadMedia(${item.id})" title="تحميل">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="action-btn btn-delete" onclick="event.stopPropagation(); deleteMedia(${item.id}, '${item.title}')" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // دالة إنشاء عنصر قائمة الوسائط
        function createMediaListItem(item) {
            // يمكن تطوير عرض القائمة لاحقاً
            return createMediaCard(item);
        }

        // دالة تحميل إحصائيات الوسائط
        async function loadMediaStats() {
            try {
                // محاولة جلب الإحصائيات من API
                try {
                    const data = await adminPanel.apiRequest('/media/stats/');
                    document.getElementById('images-count').textContent = data.images || 0;
                    document.getElementById('videos-count').textContent = data.videos || 0;
                    document.getElementById('documents-count').textContent = data.documents || 0;
                    document.getElementById('total-size').textContent = formatFileSize(data.total_size || 0);
                } catch (error) {
                    // عرض بيانات تجريبية
                    document.getElementById('images-count').textContent = '24';
                    document.getElementById('videos-count').textContent = '8';
                    document.getElementById('documents-count').textContent = '12';
                    document.getElementById('total-size').textContent = '156 MB';
                }
                
            } catch (error) {
                console.error('Error loading media stats:', error);
            }
        }

        // دالة إعداد منطقة الرفع
        function setupUploadArea() {
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');
            
            // منع السلوك الافتراضي للسحب والإفلات
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });
            
            // إضافة تأثيرات بصرية للسحب والإفلات
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            // التعامل مع الملفات المسحوبة
            uploadArea.addEventListener('drop', handleDrop, false);
            
            // النقر لاختيار الملفات
            uploadArea.addEventListener('click', () => fileInput.click());
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            function highlight() {
                uploadArea.classList.add('dragover');
            }
            
            function unhighlight() {
                uploadArea.classList.remove('dragover');
            }
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }
        }

        // دالة التعامل مع رفع الملفات
        function handleFileUpload(e) {
            const files = e.target.files;
            handleFiles(files);
        }

        // دالة معالجة الملفات
        async function handleFiles(files) {
            if (files.length === 0) return;
            
            adminPanel.showNotification(`جاري رفع ${files.length} ملف...`, 'info');
            
            for (let file of files) {
                try {
                    await uploadFile(file);
                } catch (error) {
                    console.error('Error uploading file:', file.name, error);
                    adminPanel.showNotification(`فشل في رفع الملف: ${file.name}`, 'error');
                }
            }
            
            // إعادة تحميل الوسائط والإحصائيات
            loadMedia();
            loadMediaStats();
            
            // إعادة تعيين input
            document.getElementById('file-input').value = '';
        }

        // دالة رفع ملف واحد
        async function uploadFile(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('title', file.name.split('.')[0]);
            
            try {
                // محاولة رفع الملف عبر API
                await adminPanel.apiRequest('/media/upload/', {
                    method: 'POST',
                    body: formData,
                    headers: {} // إزالة Content-Type للسماح للمتصفح بتعيينه تلقائياً
                });
                
                adminPanel.showNotification(`تم رفع الملف: ${file.name}`, 'success');
                
            } catch (error) {
                // محاكاة نجاح الرفع
                console.log('File uploaded (simulated):', file.name);
                adminPanel.showNotification(`تم رفع الملف: ${file.name}`, 'success');
            }
        }

        // دالة عرض الوسائط
        async function viewMedia(id) {
            try {
                currentMediaId = id;
                
                // محاولة جلب تفاصيل الوسائط من API
                try {
                    const media = await adminPanel.apiRequest(`/media/${id}/`);
                    displayMediaDetails(media);
                } catch (error) {
                    // عرض بيانات تجريبية
                    displaySampleMediaDetails(id);
                }
                
                document.getElementById('media-modal').style.display = 'block';
                
            } catch (error) {
                adminPanel.showNotification('حدث خطأ في تحميل تفاصيل الملف', 'error');
            }
        }

        // دالة عرض تفاصيل الوسائط
        function displayMediaDetails(media) {
            const detailsHtml = `
                <div>
                    ${media.type === 'image' ? 
                        `<img src="${media.url}" alt="${media.title}" class="media-preview-large">` :
                        `<div class="media-preview-large" style="display: flex; align-items: center; justify-content: center; height: 200px; background: #f8f9fa;">
                            <i class="${getFileIcon(media.type, media.filename)}" style="font-size: 64px; color: #6c757d;"></i>
                        </div>`
                    }
                </div>
                <div class="media-properties">
                    <div class="property-item">
                        <span class="property-label">اسم الملف:</span>
                        <span class="property-value">${media.filename}</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">النوع:</span>
                        <span class="property-value">${getTypeText(media.type)}</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">الحجم:</span>
                        <span class="property-value">${media.size}</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">تاريخ الرفع:</span>
                        <span class="property-value">${formatDate(media.uploaded_at)}</span>
                    </div>
                    <div class="property-item">
                        <span class="property-label">الرابط:</span>
                        <span class="property-value"><a href="${media.url}" target="_blank">عرض الملف</a></span>
                    </div>
                </div>
            `;
            
            document.getElementById('media-details').innerHTML = detailsHtml;
        }

        // دالة عرض تفاصيل وسائط تجريبية
        function displaySampleMediaDetails(id) {
            const sampleMedia = {
                filename: 'sample-file.jpg',
                type: 'image',
                size: '245 KB',
                uploaded_at: '2024-01-15',
                url: '/placeholder-image.jpg'
            };
            
            displayMediaDetails(sampleMedia);
        }

        // دالة تعديل الوسائط
        async function editMedia(id = null) {
            const mediaId = id || currentMediaId;
            
            try {
                // جلب بيانات الوسائط للتعديل
                try {
                    const media = await adminPanel.apiRequest(`/media/${mediaId}/`);
                    document.getElementById('media-title').value = media.title || '';
                    document.getElementById('media-description').value = media.description || '';
                    document.getElementById('media-alt').value = media.alt_text || '';
                } catch (error) {
                    // بيانات تجريبية
                    document.getElementById('media-title').value = 'عنوان الملف';
                    document.getElementById('media-description').value = '';
                    document.getElementById('media-alt').value = '';
                }
                
                currentMediaId = mediaId;
                document.getElementById('edit-modal').style.display = 'block';
                
            } catch (error) {
                adminPanel.showNotification('حدث خطأ في تحميل بيانات الملف', 'error');
            }
        }

        // دالة حفظ تغييرات الوسائط
        async function saveMediaChanges() {
            const form = document.getElementById('edit-media-form');
            const formData = new FormData(form);
            
            const data = {
                title: formData.get('title'),
                description: formData.get('description'),
                alt_text: formData.get('alt_text')
            };
            
            // التحقق من صحة البيانات
            if (!adminPanel.validateRequired(data.title)) {
                adminPanel.showNotification('عنوان الملف مطلوب', 'error');
                return;
            }
            
            try {
                // محاولة حفظ التغييرات عبر API
                try {
                    await adminPanel.apiRequest(`/media/${currentMediaId}/`, {
                        method: 'PATCH',
                        body: JSON.stringify(data),
                    });
                } catch (error) {
                    // محاكاة نجاح الحفظ
                    console.log('Media updated (simulated):', data);
                }
                
                adminPanel.showNotification('تم حفظ التغييرات بنجاح', 'success');
                closeEditModal();
                loadMedia();
                
            } catch (error) {
                adminPanel.showNotification('حدث خطأ في حفظ التغييرات', 'error');
            }
        }

        // دالة تحميل الوسائط
        function downloadMedia(id = null) {
            const mediaId = id || currentMediaId;
            
            // محاكاة تحميل الملف
            adminPanel.showNotification('جاري تحميل الملف...', 'info');
            
            // في التطبيق الحقيقي، سيتم إنشاء رابط تحميل
            setTimeout(() => {
                adminPanel.showNotification('تم بدء التحميل', 'success');
            }, 1000);
        }

        // دالة حذف الوسائط
        async function deleteMedia(id, title) {
            if (confirm(`هل أنت متأكد من حذف الملف "${title}"؟ لا يمكن التراجع عن هذا الإجراء.`)) {
                try {
                    // محاولة حذف الملف عبر API
                    try {
                        await adminPanel.apiRequest(`/media/${id}/`, {
                            method: 'DELETE',
                        });
                    } catch (error) {
                        // محاكاة نجاح الحذف
                        console.log('Media deleted (simulated):', id);
                    }
                    
                    adminPanel.showNotification('تم حذف الملف بنجاح', 'success');
                    loadMedia();
                    loadMediaStats();
                    
                } catch (error) {
                    adminPanel.showNotification('حدث خطأ في حذف الملف', 'error');
                }
            }
        }

        // دالة تبديل العرض
        function switchView(view) {
            currentView = view;
            
            // تحديث أزرار العرض
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // تبديل العرض
            if (view === 'grid') {
                document.getElementById('media-grid').style.display = 'grid';
                document.getElementById('media-list').style.display = 'none';
            } else {
                document.getElementById('media-grid').style.display = 'none';
                document.getElementById('media-list').style.display = 'block';
            }
            
            // إعادة تحميل البيانات
            loadMedia();
        }

        // دالة عرض نموذج الرفع
        function showUploadModal() {
            document.getElementById('file-input').click();
        }

        // دالة تحديث الترقيم
        function updatePagination(data) {
            const pagination = document.getElementById('pagination');
            
            if (data.count && data.count > mediaPerPage) {
                totalPages = Math.ceil(data.count / mediaPerPage);
                
                let paginationHtml = '';
                
                // زر السابق
                paginationHtml += `
                    <button onclick="loadMedia(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                `;
                
                // أرقام الصفحات
                for (let i = 1; i <= totalPages; i++) {
                    if (i === currentPage || i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                        paginationHtml += `
                            <button onclick="loadMedia(${i})" class="${i === currentPage ? 'active' : ''}">
                                ${i}
                            </button>
                        `;
                    } else if (i === currentPage - 3 || i === currentPage + 3) {
                        paginationHtml += '<span>...</span>';
                    }
                }
                
                // زر التالي
                paginationHtml += `
                    <button onclick="loadMedia(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                `;
                
                pagination.innerHTML = paginationHtml;
                pagination.style.display = 'flex';
            } else {
                pagination.style.display = 'none';
            }
        }

        // دالة إغلاق نموذج الوسائط
        function closeMediaModal() {
            document.getElementById('media-modal').style.display = 'none';
            currentMediaId = null;
        }

        // دالة إغلاق نموذج التعديل
        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
            document.getElementById('edit-media-form').reset();
        }

        // دوال مساعدة للعرض
        function showMediaLoading() {
            document.getElementById('media-loading').style.display = 'block';
            document.getElementById('media-grid').style.display = 'none';
            document.getElementById('media-list').style.display = 'none';
            document.getElementById('media-no-data').style.display = 'none';
        }

        function showMediaGrid() {
            document.getElementById('media-loading').style.display = 'none';
            if (currentView === 'grid') {
                document.getElementById('media-grid').style.display = 'grid';
                document.getElementById('media-list').style.display = 'none';
            } else {
                document.getElementById('media-grid').style.display = 'none';
                document.getElementById('media-list').style.display = 'block';
            }
            document.getElementById('media-no-data').style.display = 'none';
        }

        function showMediaNoData() {
            document.getElementById('media-loading').style.display = 'none';
            document.getElementById('media-grid').style.display = 'none';
            document.getElementById('media-list').style.display = 'none';
            document.getElementById('media-no-data').style.display = 'block';
        }

        // دالة الحصول على نص النوع
        function getTypeText(type) {
            const types = {
                'image': 'صورة',
                'video': 'فيديو',
                'document': 'مستند'
            };
            return types[type] || type;
        }

        // دالة الحصول على أيقونة الملف
        function getFileIcon(type, filename) {
            if (type === 'image') return 'fas fa-image';
            if (type === 'video') return 'fas fa-video';
            
            const extension = filename.split('.').pop().toLowerCase();
            
            if (['pdf'].includes(extension)) return 'fas fa-file-pdf';
            if (['doc', 'docx'].includes(extension)) return 'fas fa-file-word';
            if (['xls', 'xlsx'].includes(extension)) return 'fas fa-file-excel';
            if (['ppt', 'pptx'].includes(extension)) return 'fas fa-file-powerpoint';
            if (['zip', 'rar'].includes(extension)) return 'fas fa-file-archive';
            
            return 'fas fa-file';
        }

        // دالة تنسيق حجم الملف
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // دالة تنسيق التاريخ
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // دالة debounce للبحث
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // إغلاق النماذج عند النقر خارجها
        window.onclick = function(event) {
            const mediaModal = document.getElementById('media-modal');
            const editModal = document.getElementById('edit-modal');
            
            if (event.target === mediaModal) {
                closeMediaModal();
            } else if (event.target === editModal) {
                closeEditModal();
            }
        }
    </script>
</body>
</html>

